<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SQLite Viewer</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=IBM+Plex+Mono:wght@300;400;500;600&family=Instrument+Sans:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.js"></script>
<style>
  :root {
    --bg-deep: #0d0d0f;
    --bg-primary: #141418;
    --bg-secondary: #1c1c22;
    --bg-elevated: #23232b;
    --bg-hover: #2a2a34;
    --border: #2e2e3a;
    --border-subtle: #222230;
    --amber-50: #fff8e1;
    --amber-100: #ffe0a0;
    --amber-200: #ffc947;
    --amber-300: #f5a623;
    --amber-400: #d4891a;
    --amber-glow: rgba(245, 166, 35, 0.08);
    --amber-glow-strong: rgba(245, 166, 35, 0.15);
    --text-primary: #e8e6e1;
    --text-secondary: #9d9b95;
    --text-muted: #666460;
    --error: #e05252;
    --success: #4caf7d;
    --info: #5b9bd5;
    --purple: #a78bfa;
    --pink: #f472b6;
    --teal: #2dd4bf;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg-deep);
    color: var(--text-primary);
    font-family: 'Instrument Sans', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  body::after {
    content: '';
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.03) 2px, rgba(0,0,0,0.03) 4px);
    pointer-events: none;
    z-index: 9999;
  }

  .ambient-glow {
    position: fixed;
    top: -200px;
    left: 50%;
    transform: translateX(-50%);
    width: 800px;
    height: 500px;
    background: radial-gradient(ellipse, rgba(245,166,35,0.04) 0%, transparent 70%);
    pointer-events: none;
    z-index: 0;
  }

  .header {
    position: relative;
    z-index: 1;
    padding: 28px 40px 20px;
    border-bottom: 1px solid var(--border-subtle);
    display: flex;
    align-items: center;
    justify-content: space-between;
    animation: fadeDown 0.6s ease;
  }

  @keyframes fadeDown { from { opacity: 0; transform: translateY(-12px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes fadeUp { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  @keyframes scaleIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }

  .header-left { display: flex; align-items: center; gap: 16px; }

  .logo-mark {
    width: 36px; height: 36px; border-radius: 8px;
    background: linear-gradient(135deg, var(--amber-300), var(--amber-400));
    display: flex; align-items: center; justify-content: center;
    font-family: 'IBM Plex Mono', monospace; font-weight: 600; font-size: 14px;
    color: var(--bg-deep); box-shadow: 0 0 20px rgba(245,166,35,0.2);
  }

  .header h1 { font-family: 'DM Serif Display', serif; font-size: 22px; font-weight: 400; letter-spacing: -0.3px; }
  .header h1 span { color: var(--amber-300); }

  .header-right { display: flex; align-items: center; gap: 12px; }
  .header-meta { font-family: 'IBM Plex Mono', monospace; font-size: 11px; color: var(--text-muted); letter-spacing: 0.5px; }

  .btn {
    font-family: 'IBM Plex Mono', monospace; font-size: 11px; font-weight: 500;
    padding: 6px 14px; border-radius: 6px; border: 1px solid var(--border);
    background: var(--bg-elevated); color: var(--text-secondary);
    cursor: pointer; transition: all 0.2s ease; letter-spacing: 0.3px;
  }
  .btn:hover { background: var(--bg-hover); color: var(--text-primary); border-color: var(--text-muted); }
  .btn-primary { background: linear-gradient(135deg, var(--amber-300), var(--amber-400)); color: var(--bg-deep); border: none; font-weight: 600; }
  .btn-primary:hover { box-shadow: 0 0 20px rgba(245,166,35,0.25); color: var(--bg-deep); }

  .breadcrumb {
    display: flex; align-items: center; gap: 6px;
    font-family: 'IBM Plex Mono', monospace; font-size: 11px; color: var(--text-muted);
  }
  .breadcrumb-link { color: var(--amber-300); cursor: pointer; transition: color 0.2s; text-decoration: none; }
  .breadcrumb-link:hover { color: var(--amber-100); }
  .breadcrumb-sep { opacity: 0.4; }
  .breadcrumb-current { color: var(--text-secondary); }

  .main-wrapper {
    position: relative; z-index: 1;
    max-width: 1200px; margin: 0 auto; padding: 24px 40px;
    animation: fadeUp 0.5s ease 0.15s both;
  }

  /* ===== WELCOME ===== */
  .welcome-state {
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    min-height: 60vh; text-align: center; animation: fadeIn 0.6s ease;
  }
  .welcome-icon {
    width: 80px; height: 80px; border-radius: 20px;
    background: linear-gradient(135deg, var(--bg-secondary), var(--bg-elevated));
    border: 1px solid var(--border);
    display: flex; align-items: center; justify-content: center;
    font-size: 32px; margin-bottom: 24px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.3);
  }
  .welcome-title { font-family: 'DM Serif Display', serif; font-size: 28px; margin-bottom: 10px; }
  .welcome-desc { font-size: 14px; color: var(--text-muted); max-width: 400px; line-height: 1.7; margin-bottom: 32px; }

  .upload-zone {
    width: 400px; max-width: 100%; border: 1.5px dashed var(--border);
    border-radius: 14px; padding: 36px 24px; cursor: pointer;
    transition: all 0.3s ease; background: var(--bg-primary);
  }
  .upload-zone:hover { border-color: var(--amber-300); background: var(--amber-glow); }
  .upload-zone.dragover { border-color: var(--amber-300); background: var(--amber-glow-strong); box-shadow: inset 0 0 40px rgba(245,166,35,0.05); }
  .upload-arrow { font-size: 28px; margin-bottom: 12px; opacity: 0.5; }
  .upload-text { font-size: 13px; color: var(--text-secondary); line-height: 1.6; }
  .upload-text strong { color: var(--amber-300); font-weight: 500; }
  .upload-hint { font-family: 'IBM Plex Mono', monospace; font-size: 10px; color: var(--text-muted); margin-top: 8px; }
  #file-input { display: none; }

  /* ===== VIEWS ===== */
  .overview-view, .table-view { display: none; }
  .overview-view.active, .table-view.active { display: block; }

  /* Stats grid */
  .stat-cards { display: grid; grid-template-columns: repeat(4, 1fr); gap: 14px; margin-bottom: 28px; }
  .stat-card {
    background: var(--bg-primary); border: 1px solid var(--border-subtle);
    border-radius: 10px; padding: 18px 20px;
    transition: all 0.25s ease; animation: scaleIn 0.4s ease both;
  }
  .stat-card:nth-child(1) { animation-delay: 0.05s; }
  .stat-card:nth-child(2) { animation-delay: 0.1s; }
  .stat-card:nth-child(3) { animation-delay: 0.15s; }
  .stat-card:nth-child(4) { animation-delay: 0.2s; }
  .stat-card:hover { border-color: var(--border); background: var(--bg-secondary); }
  .stat-label { font-family: 'IBM Plex Mono', monospace; font-size: 10px; font-weight: 500; text-transform: uppercase; letter-spacing: 1.2px; color: var(--text-muted); margin-bottom: 8px; }
  .stat-value { font-family: 'DM Serif Display', serif; font-size: 28px; line-height: 1; }
  .stat-sub { font-family: 'IBM Plex Mono', monospace; font-size: 10px; color: var(--text-muted); margin-top: 6px; }
  .stat-value.amber { color: var(--amber-300); }
  .stat-value.teal { color: var(--teal); }
  .stat-value.purple { color: var(--purple); }
  .stat-value.pink { color: var(--pink); }

  .section-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px; }
  .section-title {
    font-family: 'IBM Plex Mono', monospace; font-size: 11px; font-weight: 500;
    text-transform: uppercase; letter-spacing: 1.5px; color: var(--text-muted);
    display: flex; align-items: center; gap: 8px;
  }
  .section-title::before { content: '›'; color: var(--amber-300); font-size: 16px; }

  .tables-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 12px; margin-bottom: 28px; }
  .table-card {
    background: var(--bg-primary); border: 1px solid var(--border-subtle);
    border-radius: 10px; padding: 18px 20px; cursor: pointer;
    transition: all 0.25s ease; animation: scaleIn 0.4s ease both;
  }
  .table-card:hover { border-color: var(--amber-400); background: var(--amber-glow); transform: translateY(-2px); box-shadow: 0 6px 24px rgba(0,0,0,0.2); }
  .table-card-head { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
  .table-card-name { font-family: 'IBM Plex Mono', monospace; font-size: 14px; font-weight: 500; display: flex; align-items: center; gap: 8px; }
  .table-card-name .icon { color: var(--amber-300); font-size: 12px; opacity: 0.7; }
  .table-card-rows { font-family: 'IBM Plex Mono', monospace; font-size: 11px; color: var(--text-muted); background: var(--bg-secondary); padding: 2px 8px; border-radius: 4px; }
  .table-card-cols { display: flex; flex-wrap: wrap; gap: 4px; }
  .col-chip { font-family: 'IBM Plex Mono', monospace; font-size: 10px; color: var(--text-muted); background: var(--bg-secondary); padding: 2px 7px; border-radius: 3px; }
  .col-chip.pk { color: var(--success); background: rgba(76,175,125,0.1); }
  .table-card-arrow { font-size: 14px; color: var(--text-muted); transition: all 0.2s ease; margin-top: 10px; text-align: right; }
  .table-card:hover .table-card-arrow { color: var(--amber-300); transform: translateX(3px); }

  /* Type distribution */
  .type-bar-container { margin-bottom: 28px; }
  .type-bar { display: flex; height: 8px; border-radius: 4px; overflow: hidden; background: var(--bg-elevated); margin-top: 10px; margin-bottom: 10px; }
  .type-bar-seg { transition: width 0.6s ease; min-width: 2px; }
  .type-legend { display: flex; flex-wrap: wrap; gap: 14px; }
  .type-legend-item { display: flex; align-items: center; gap: 6px; font-family: 'IBM Plex Mono', monospace; font-size: 10px; color: var(--text-muted); }
  .type-legend-dot { width: 8px; height: 8px; border-radius: 2px; }

  /* Table detail view */
  .table-view-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; }
  .table-view-title { font-family: 'DM Serif Display', serif; font-size: 24px; }
  .table-view-title span { color: var(--amber-300); }

  /* Query panel */
  .query-panel { background: var(--bg-primary); border: 1px solid var(--border-subtle); border-radius: 10px; overflow: hidden; margin-bottom: 16px; }
  .query-bar { display: flex; align-items: center; justify-content: space-between; padding: 10px 16px; border-bottom: 1px solid var(--border-subtle); background: var(--bg-secondary); }
  .query-bar-title { font-family: 'IBM Plex Mono', monospace; font-size: 11px; font-weight: 500; text-transform: uppercase; letter-spacing: 1px; color: var(--text-muted); display: flex; align-items: center; gap: 8px; }
  .query-bar-title::before { content: '›'; color: var(--amber-300); font-size: 16px; }
  .query-actions { display: flex; gap: 8px; }

  .query-editor textarea {
    width: 100%; min-height: 72px; padding: 14px 16px;
    background: transparent; border: none; color: var(--amber-100);
    font-family: 'IBM Plex Mono', monospace; font-size: 13px;
    line-height: 1.6; resize: vertical; outline: none;
  }
  .query-editor textarea::placeholder { color: var(--text-muted); }
  .shortcut-hint { font-family: 'IBM Plex Mono', monospace; font-size: 10px; color: var(--text-muted); padding: 0 16px 10px; }
  .shortcut-hint kbd { background: var(--bg-elevated); border: 1px solid var(--border); border-radius: 3px; padding: 1px 5px; font-size: 10px; }

  /* Results */
  .results-panel {
    background: var(--bg-primary); border: 1px solid var(--border-subtle);
    border-radius: 10px; overflow: hidden;
    display: flex; flex-direction: column; min-height: 300px;
  }
  .results-bar { display: flex; align-items: center; justify-content: space-between; padding: 10px 16px; border-bottom: 1px solid var(--border-subtle); background: var(--bg-secondary); flex-shrink: 0; }
  .results-bar-left { display: flex; align-items: center; gap: 12px; }
  .results-title { font-family: 'IBM Plex Mono', monospace; font-size: 11px; font-weight: 500; text-transform: uppercase; letter-spacing: 1px; color: var(--text-muted); }
  .results-count { font-family: 'IBM Plex Mono', monospace; font-size: 11px; color: var(--amber-300); background: var(--amber-glow); padding: 2px 8px; border-radius: 4px; border: 1px solid rgba(245,166,35,0.1); }
  .results-time { font-family: 'IBM Plex Mono', monospace; font-size: 10px; color: var(--text-muted); }

  .tab-bar { display: flex; gap: 2px; padding: 0 16px; background: var(--bg-secondary); border-bottom: 1px solid var(--border-subtle); }
  .tab { font-family: 'IBM Plex Mono', monospace; font-size: 11px; font-weight: 500; padding: 10px 16px; color: var(--text-muted); cursor: pointer; border-bottom: 2px solid transparent; transition: all 0.2s ease; text-transform: uppercase; letter-spacing: 0.8px; }
  .tab:hover { color: var(--text-secondary); }
  .tab.active { color: var(--amber-300); border-bottom-color: var(--amber-300); }

  .results-scroll { flex: 1; overflow: auto; }
  .results-scroll::-webkit-scrollbar { width: 8px; height: 8px; }
  .results-scroll::-webkit-scrollbar-track { background: var(--bg-primary); }
  .results-scroll::-webkit-scrollbar-thumb { background: var(--bg-hover); border-radius: 4px; }

  .data-table { width: 100%; border-collapse: collapse; font-family: 'IBM Plex Mono', monospace; font-size: 12px; }
  .data-table thead { position: sticky; top: 0; z-index: 2; }
  .data-table th {
    background: var(--bg-elevated); padding: 10px 14px; text-align: left;
    font-weight: 500; font-size: 11px; text-transform: uppercase;
    letter-spacing: 0.8px; color: var(--text-muted);
    border-bottom: 1px solid var(--border); white-space: nowrap; position: relative;
  }
  .data-table th::after { content: ''; position: absolute; right: 0; top: 25%; height: 50%; width: 1px; background: var(--border-subtle); }
  .data-table th:last-child::after { display: none; }
  .data-table td {
    padding: 8px 14px; border-bottom: 1px solid var(--border-subtle);
    color: var(--text-secondary); max-width: 300px; overflow: hidden;
    text-overflow: ellipsis; white-space: nowrap; font-weight: 300;
  }
  .data-table tbody tr { transition: background 0.15s ease; }
  .data-table tbody tr:hover { background: var(--amber-glow); }
  .data-table tbody tr:hover td { color: var(--text-primary); }
  .cell-null { color: var(--text-muted); font-style: italic; font-size: 10px; }
  .cell-number { color: var(--info); font-weight: 400; }
  .cell-string { color: var(--amber-100); }

  .pagination { display: flex; align-items: center; justify-content: center; gap: 6px; padding: 12px 16px; border-top: 1px solid var(--border-subtle); background: var(--bg-secondary); flex-shrink: 0; }
  .page-btn { font-family: 'IBM Plex Mono', monospace; font-size: 11px; padding: 5px 10px; border-radius: 5px; border: 1px solid var(--border); background: var(--bg-elevated); color: var(--text-secondary); cursor: pointer; transition: all 0.2s ease; }
  .page-btn:hover:not(:disabled) { background: var(--bg-hover); color: var(--text-primary); }
  .page-btn:disabled { opacity: 0.3; cursor: not-allowed; }
  .page-info { font-family: 'IBM Plex Mono', monospace; font-size: 11px; color: var(--text-muted); padding: 0 8px; }

  .schema-cols { padding: 4px 0; }
  .schema-col { display: flex; align-items: center; gap: 10px; padding: 7px 16px; font-family: 'IBM Plex Mono', monospace; font-size: 12px; transition: background 0.15s; }
  .schema-col:hover { background: var(--bg-secondary); }
  .schema-col-name { color: var(--text-primary); font-weight: 400; min-width: 160px; }
  .schema-col-type { color: var(--amber-300); font-size: 10px; font-weight: 500; text-transform: uppercase; background: var(--amber-glow); padding: 1px 6px; border-radius: 3px; }
  .schema-col-pk { color: var(--success); font-size: 9px; font-weight: 600; text-transform: uppercase; }
  .schema-col-nn { color: var(--text-muted); font-size: 9px; text-transform: uppercase; }

  .status-msg { padding: 10px 16px; font-family: 'IBM Plex Mono', monospace; font-size: 12px; border-radius: 6px; margin: 8px 0; }
  .status-error { background: rgba(224,82,82,0.08); border: 1px solid rgba(224,82,82,0.2); color: var(--error); }
  .status-success { background: rgba(76,175,125,0.08); border: 1px solid rgba(76,175,125,0.2); color: var(--success); }

  .empty-results { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 48px 24px; text-align: center; }
  .empty-results-icon { font-size: 36px; opacity: 0.25; margin-bottom: 12px; }
  .empty-results-text { font-size: 13px; color: var(--text-muted); }

  @media (max-width: 900px) { .stat-cards { grid-template-columns: repeat(2, 1fr); } .main-wrapper { padding: 16px 20px; } .header { padding: 16px 20px; } }
  @media (max-width: 500px) { .stat-cards { grid-template-columns: 1fr; } }
</style>
</head>
<body>

<div class="ambient-glow"></div>

<header class="header">
  <div class="header-left">
    <div class="logo-mark">db</div>
    <h1>SQLite <span>Viewer</span></h1>
  </div>
  <div class="header-right">
    <div class="header-meta" id="db-name"></div>
    <button class="btn" id="btn-load-new" style="display:none" onclick="document.getElementById('file-input').click()">Load another</button>
  </div>
</header>

<input type="file" id="file-input" accept=".sqlite,.db,.sqlite3,.sql">

<div class="main-wrapper">

  <!-- WELCOME -->
  <div id="welcome-state" class="welcome-state">
    <div class="welcome-icon">⬡</div>
    <div class="welcome-title">Open a SQLite Database</div>
    <div class="welcome-desc">Drop a database file below to explore its tables, run queries, and inspect schema — all in the browser.</div>
    <div class="upload-zone" id="upload-zone">
      <div class="upload-arrow">↑</div>
      <div class="upload-text">Drop <strong>.sqlite</strong> or <strong>.db</strong> file here<br>or click to browse</div>
      <div class="upload-hint">.sqlite · .db · .sqlite3</div>
    </div>
  </div>

  <!-- OVERVIEW -->
  <div id="overview-view" class="overview-view">
    <div class="stat-cards" id="stat-cards"></div>

    <div class="type-bar-container" id="type-bar-container">
      <div class="section-title">Column Type Distribution</div>
      <div class="type-bar" id="type-bar"></div>
      <div class="type-legend" id="type-legend"></div>
    </div>

    <div class="section-header"><div class="section-title">Tables</div></div>
    <div class="tables-grid" id="tables-grid"></div>

    <div class="query-panel" style="margin-top:8px">
      <div class="query-bar">
        <div class="query-bar-title">SQL Query</div>
        <div class="query-actions">
          <button class="btn" id="btn-clear-ov">Clear</button>
          <button class="btn btn-primary" id="btn-run-ov">▶ Run</button>
        </div>
      </div>
      <div class="query-editor"><textarea id="query-input-ov" placeholder="SELECT * FROM table_name LIMIT 100;" spellcheck="false"></textarea></div>
      <div class="shortcut-hint"><kbd>Ctrl</kbd> + <kbd>Enter</kbd> to execute</div>
    </div>
    <div class="results-panel" id="results-panel-ov" style="margin-top:12px;display:none">
      <div class="results-bar">
        <div class="results-bar-left"><span class="results-title">Results</span><span class="results-count" id="results-count-ov"></span></div>
        <span class="results-time" id="results-time-ov"></span>
      </div>
      <div class="results-scroll"><table class="data-table" id="data-table-ov"><thead id="table-head-ov"></thead><tbody id="table-body-ov"></tbody></table></div>
      <div class="pagination" id="pagination-ov" style="display:none"></div>
    </div>
    <div id="status-area-ov"></div>
  </div>

  <!-- TABLE VIEW -->
  <div id="table-view" class="table-view">
    <div class="breadcrumb">
      <a class="breadcrumb-link" onclick="showOverview()">Overview</a>
      <span class="breadcrumb-sep">›</span>
      <span class="breadcrumb-current" id="breadcrumb-table"></span>
    </div>
    <div class="table-view-header" style="margin-top:12px">
      <div class="table-view-title" id="table-view-title"></div>
    </div>
    <div class="query-panel">
      <div class="query-bar">
        <div class="query-bar-title">SQL Query</div>
        <div class="query-actions">
          <button class="btn" id="btn-clear-tv">Clear</button>
          <button class="btn btn-primary" id="btn-run-tv">▶ Run</button>
        </div>
      </div>
      <div class="query-editor"><textarea id="query-input-tv" placeholder="SELECT * FROM table_name LIMIT 100;" spellcheck="false"></textarea></div>
      <div class="shortcut-hint"><kbd>Ctrl</kbd> + <kbd>Enter</kbd> to execute</div>
    </div>
    <div class="results-panel" id="results-panel-tv">
      <div class="results-bar">
        <div class="results-bar-left"><span class="results-title">Results</span><span class="results-count" id="results-count-tv" style="display:none"></span></div>
        <span class="results-time" id="results-time-tv"></span>
      </div>
      <div class="tab-bar" id="tab-bar-tv">
        <div class="tab active" data-tab="data">Data</div>
        <div class="tab" data-tab="schema">Schema</div>
      </div>
      <div class="results-scroll" id="results-scroll-tv">
        <div class="empty-results" id="empty-results-tv"><div class="empty-results-icon">⬡</div><div class="empty-results-text">Run a query to see results</div></div>
        <table class="data-table" id="data-table-tv" style="display:none"><thead id="table-head-tv"></thead><tbody id="table-body-tv"></tbody></table>
        <div class="schema-cols" id="schema-view-tv" style="display:none"></div>
      </div>
      <div class="pagination" id="pagination-tv" style="display:none"></div>
    </div>
    <div id="status-area-tv"></div>
  </div>

</div>

<script>
(function() {
  let db = null, dbFileSize = 0, currentTable = null;
  let ovResults = { columns: [], values: [] }, ovPage = 0;
  let tvResults = { columns: [], values: [] }, tvPage = 0, tvActiveTab = 'data';
  const PAGE_SIZE = 50;

  const uploadZone = document.getElementById('upload-zone');
  const fileInput = document.getElementById('file-input');

  uploadZone.addEventListener('click', () => fileInput.click());
  uploadZone.addEventListener('dragover', e => { e.preventDefault(); uploadZone.classList.add('dragover'); });
  uploadZone.addEventListener('dragleave', () => uploadZone.classList.remove('dragover'));
  uploadZone.addEventListener('drop', e => { e.preventDefault(); uploadZone.classList.remove('dragover'); if (e.dataTransfer.files.length) loadFile(e.dataTransfer.files[0]); });
  fileInput.addEventListener('change', e => { if (e.target.files.length) loadFile(e.target.files[0]); });
  document.body.addEventListener('dragover', e => e.preventDefault());
  document.body.addEventListener('drop', e => { e.preventDefault(); if (e.dataTransfer.files.length) loadFile(e.dataTransfer.files[0]); });

  async function loadFile(file) {
    try {
      const SQL = await initSqlJs({ locateFile: f => `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/${f}` });
      const buffer = await file.arrayBuffer();
      db = new SQL.Database(new Uint8Array(buffer));
      dbFileSize = file.size;
      document.getElementById('db-name').textContent = file.name;
      document.getElementById('btn-load-new').style.display = 'inline-block';
      showOverview();
    } catch (err) { alert('Failed to load database: ' + err.message); }
  }

  function hideAll() {
    document.getElementById('welcome-state').style.display = 'none';
    document.getElementById('overview-view').classList.remove('active');
    document.getElementById('table-view').classList.remove('active');
  }

  window.showOverview = function() {
    hideAll(); currentTable = null;
    document.getElementById('overview-view').classList.add('active');
    renderOverview();
  };

  window.openTable = function(name) {
    hideAll(); currentTable = name;
    document.getElementById('table-view').classList.add('active');
    document.getElementById('breadcrumb-table').textContent = name;
    document.getElementById('table-view-title').innerHTML = `<span>◇</span> ${escHtml(name)}`;
    document.getElementById('query-input-tv').value = `SELECT * FROM "${name}" LIMIT 100;`;
    tvActiveTab = 'data';
    document.querySelectorAll('#tab-bar-tv .tab').forEach(t => t.classList.toggle('active', t.dataset.tab === 'data'));
    runTvQuery();
  };

  // ===== OVERVIEW =====
  function renderOverview() {
    if (!db) return;
    const tablesRes = db.exec("SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%' ORDER BY name");
    const tables = tablesRes.length ? tablesRes[0].values.map(r => r[0]) : [];
    const viewsRes = db.exec("SELECT COUNT(*) FROM sqlite_master WHERE type='view'");
    const viewCount = viewsRes.length ? viewsRes[0].values[0][0] : 0;
    const indexRes = db.exec("SELECT COUNT(*) FROM sqlite_master WHERE type='index'");
    const indexCount = indexRes.length ? indexRes[0].values[0][0] : 0;
    const triggerRes = db.exec("SELECT COUNT(*) FROM sqlite_master WHERE type='trigger'");
    const triggerCount = triggerRes.length ? triggerRes[0].values[0][0] : 0;

    let totalRows = 0, totalCols = 0;
    const tableDetails = [], typeCounts = {};

    tables.forEach(name => {
      const rowCount = db.exec(`SELECT COUNT(*) FROM "${name}"`)[0].values[0][0];
      totalRows += rowCount;
      const colInfo = db.exec(`PRAGMA table_info("${name}")`);
      const cols = colInfo.length ? colInfo[0].values : [];
      totalCols += cols.length;
      cols.forEach(c => { const t = (c[2] || 'UNTYPED').toUpperCase(); typeCounts[t] = (typeCounts[t] || 0) + 1; });
      tableDetails.push({ name, rowCount, columns: cols.map(c => ({ name: c[1], type: c[2], pk: c[5] })) });
    });

    document.getElementById('stat-cards').innerHTML = `
      <div class="stat-card"><div class="stat-label">Tables</div><div class="stat-value amber">${tables.length}</div><div class="stat-sub">${viewCount} view${viewCount!==1?'s':''} · ${triggerCount} trigger${triggerCount!==1?'s':''}</div></div>
      <div class="stat-card"><div class="stat-label">Total Rows</div><div class="stat-value teal">${totalRows.toLocaleString()}</div><div class="stat-sub">across all tables</div></div>
      <div class="stat-card"><div class="stat-label">Total Columns</div><div class="stat-value purple">${totalCols}</div><div class="stat-sub">${Object.keys(typeCounts).length} distinct type${Object.keys(typeCounts).length!==1?'s':''}</div></div>
      <div class="stat-card"><div class="stat-label">Indexes</div><div class="stat-value pink">${indexCount}</div><div class="stat-sub">file: ${formatBytes(dbFileSize)}</div></div>
    `;

    // Type bar
    const typeColors = { 'INTEGER':'#f5a623','INT':'#f5a623','TEXT':'#5b9bd5','VARCHAR':'#5b9bd5','CHAR':'#5b9bd5','REAL':'#2dd4bf','FLOAT':'#2dd4bf','DOUBLE':'#2dd4bf','NUMERIC':'#2dd4bf','BLOB':'#a78bfa','BOOLEAN':'#f472b6','DATE':'#fb923c','DATETIME':'#fb923c','TIMESTAMP':'#fb923c' };
    const fallbackColors = ['#94a3b8','#6ee7b7','#fbbf24','#c084fc','#fb7185','#67e8f9'];
    let ci = 0;
    const total = Object.values(typeCounts).reduce((a,b) => a+b, 0);

    if (total > 0) {
      document.getElementById('type-bar-container').style.display = 'block';
      const sorted = Object.entries(typeCounts).sort((a,b) => b[1] - a[1]);
      let barHtml = '', legHtml = '';
      sorted.forEach(([type, count]) => {
        const pct = count / total * 100;
        let color = typeColors[type]; if (!color) { color = fallbackColors[ci % fallbackColors.length]; ci++; }
        barHtml += `<div class="type-bar-seg" style="width:${pct}%;background:${color}"></div>`;
        legHtml += `<div class="type-legend-item"><div class="type-legend-dot" style="background:${color}"></div>${type} <span style="color:var(--text-secondary)">${count}</span></div>`;
      });
      document.getElementById('type-bar').innerHTML = barHtml;
      document.getElementById('type-legend').innerHTML = legHtml;
    } else { document.getElementById('type-bar-container').style.display = 'none'; }

    document.getElementById('tables-grid').innerHTML = tableDetails.map((t, i) => `
      <div class="table-card" style="animation-delay:${0.05+i*0.04}s" onclick="openTable('${t.name.replace(/'/g,"\\'")}')">
        <div class="table-card-head">
          <div class="table-card-name"><span class="icon">◇</span> ${escHtml(t.name)}</div>
          <div class="table-card-rows">${t.rowCount.toLocaleString()} rows</div>
        </div>
        <div class="table-card-cols">
          ${t.columns.slice(0,8).map(c => `<span class="col-chip${c.pk?' pk':''}">${escHtml(c.name)}</span>`).join('')}
          ${t.columns.length > 8 ? `<span class="col-chip">+${t.columns.length-8}</span>` : ''}
        </div>
        <div class="table-card-arrow">→</div>
      </div>
    `).join('');
  }

  // ===== OVERVIEW QUERY =====
  const btnRunOv = document.getElementById('btn-run-ov');
  const btnClearOv = document.getElementById('btn-clear-ov');
  const qOv = document.getElementById('query-input-ov');
  btnRunOv.addEventListener('click', runOvQuery);
  btnClearOv.addEventListener('click', () => { qOv.value = ''; qOv.focus(); });
  qOv.addEventListener('keydown', e => { if ((e.ctrlKey||e.metaKey) && e.key==='Enter') { e.preventDefault(); runOvQuery(); } if (e.key==='Tab') { e.preventDefault(); insertTab(qOv); } });

  function runOvQuery() {
    if (!db) return;
    const sql = qOv.value.trim(); if (!sql) return;
    document.getElementById('status-area-ov').innerHTML = '';
    const t0 = performance.now();
    try {
      const results = db.exec(sql);
      const elapsed = (performance.now()-t0).toFixed(1);
      document.getElementById('results-time-ov').textContent = elapsed + ' ms';
      if (results.length > 0 && results[0].columns.length > 0) {
        ovResults = results[0]; ovPage = 0;
        document.getElementById('results-panel-ov').style.display = 'flex';
        document.getElementById('results-count-ov').textContent = ovResults.values.length + ' rows';
        renderOvPage();
      } else {
        document.getElementById('results-panel-ov').style.display = 'none';
        document.getElementById('status-area-ov').innerHTML = '<div class="status-msg status-success">Query executed successfully.</div>';
        renderOverview();
      }
    } catch (err) { document.getElementById('status-area-ov').innerHTML = `<div class="status-msg status-error">${escHtml(err.message)}</div>`; }
  }

  function renderOvPage() {
    const { columns, values } = ovResults;
    document.getElementById('table-head-ov').innerHTML = '<tr>' + columns.map(c => `<th>${escHtml(c)}</th>`).join('') + '</tr>';
    const start = ovPage * PAGE_SIZE;
    document.getElementById('table-body-ov').innerHTML = values.slice(start, start + PAGE_SIZE).map(row => '<tr>' + row.map(formatCell).join('') + '</tr>').join('');
    const totalPages = Math.ceil(values.length / PAGE_SIZE);
    const p = document.getElementById('pagination-ov');
    if (totalPages > 1) { p.style.display = 'flex'; p.innerHTML = `<button class="page-btn" onclick="window.__ovP(${ovPage-1})" ${ovPage===0?'disabled':''}>‹ Prev</button><span class="page-info">${ovPage+1} / ${totalPages}</span><button class="page-btn" onclick="window.__ovP(${ovPage+1})" ${ovPage>=totalPages-1?'disabled':''}>Next ›</button>`; } else { p.style.display = 'none'; }
  }
  window.__ovP = function(pg) { const tp = Math.ceil(ovResults.values.length / PAGE_SIZE); if (pg < 0 || pg >= tp) return; ovPage = pg; renderOvPage(); };

  // ===== TABLE VIEW QUERY =====
  const btnRunTv = document.getElementById('btn-run-tv');
  const btnClearTv = document.getElementById('btn-clear-tv');
  const qTv = document.getElementById('query-input-tv');
  btnRunTv.addEventListener('click', runTvQuery);
  btnClearTv.addEventListener('click', () => { qTv.value = ''; qTv.focus(); });
  qTv.addEventListener('keydown', e => { if ((e.ctrlKey||e.metaKey) && e.key==='Enter') { e.preventDefault(); runTvQuery(); } if (e.key==='Tab') { e.preventDefault(); insertTab(qTv); } });

  document.getElementById('tab-bar-tv').addEventListener('click', e => {
    const tab = e.target.closest('.tab'); if (!tab) return;
    tvActiveTab = tab.dataset.tab;
    document.querySelectorAll('#tab-bar-tv .tab').forEach(t => t.classList.toggle('active', t.dataset.tab === tvActiveTab));
    if (tvActiveTab === 'data') {
      document.getElementById('data-table-tv').style.display = tvResults.columns.length ? 'table' : 'none';
      document.getElementById('schema-view-tv').style.display = 'none';
      document.getElementById('empty-results-tv').style.display = tvResults.columns.length ? 'none' : 'flex';
      if (tvResults.columns.length) renderTvPage();
    } else {
      document.getElementById('data-table-tv').style.display = 'none';
      document.getElementById('schema-view-tv').style.display = 'block';
      document.getElementById('empty-results-tv').style.display = 'none';
      document.getElementById('pagination-tv').style.display = 'none';
      renderSchema();
    }
  });

  function runTvQuery() {
    if (!db) return;
    const sql = qTv.value.trim(); if (!sql) return;
    document.getElementById('status-area-tv').innerHTML = '';
    const t0 = performance.now();
    try {
      const results = db.exec(sql);
      const elapsed = (performance.now()-t0).toFixed(1);
      document.getElementById('results-time-tv').textContent = elapsed + ' ms';
      if (results.length > 0 && results[0].columns.length > 0) {
        tvResults = results[0]; tvPage = 0;
        document.getElementById('results-count-tv').style.display = 'inline';
        document.getElementById('results-count-tv').textContent = tvResults.values.length + ' rows';
        document.getElementById('empty-results-tv').style.display = 'none';
        if (tvActiveTab === 'data') { document.getElementById('data-table-tv').style.display = 'table'; document.getElementById('schema-view-tv').style.display = 'none'; renderTvPage(); }
      } else {
        tvResults = { columns: [], values: [] };
        document.getElementById('results-count-tv').textContent = '0 rows';
        document.getElementById('status-area-tv').innerHTML = '<div class="status-msg status-success">Query executed successfully.</div>';
        document.getElementById('data-table-tv').style.display = 'none';
        document.getElementById('pagination-tv').style.display = 'none';
      }
    } catch (err) { document.getElementById('status-area-tv').innerHTML = `<div class="status-msg status-error">${escHtml(err.message)}</div>`; }
  }

  function renderTvPage() {
    const { columns, values } = tvResults; if (!columns.length) return;
    document.getElementById('table-head-tv').innerHTML = '<tr>' + columns.map(c => `<th>${escHtml(c)}</th>`).join('') + '</tr>';
    const start = tvPage * PAGE_SIZE;
    document.getElementById('table-body-tv').innerHTML = values.slice(start, start + PAGE_SIZE).map(row => '<tr>' + row.map(formatCell).join('') + '</tr>').join('');
    const totalPages = Math.ceil(values.length / PAGE_SIZE);
    const p = document.getElementById('pagination-tv');
    if (totalPages > 1) { p.style.display = 'flex'; p.innerHTML = `<button class="page-btn" onclick="window.__tvP(${tvPage-1})" ${tvPage===0?'disabled':''}>‹ Prev</button><span class="page-info">${tvPage+1} / ${totalPages}</span><button class="page-btn" onclick="window.__tvP(${tvPage+1})" ${tvPage>=totalPages-1?'disabled':''}>Next ›</button>`; } else { p.style.display = 'none'; }
  }
  window.__tvP = function(pg) { const tp = Math.ceil(tvResults.values.length / PAGE_SIZE); if (pg < 0 || pg >= tp) return; tvPage = pg; renderTvPage(); document.getElementById('results-scroll-tv').scrollTop = 0; };

  function renderSchema() {
    if (!currentTable) return;
    const info = db.exec(`PRAGMA table_info("${currentTable}")`);
    const el = document.getElementById('schema-view-tv');
    if (!info.length) { el.innerHTML = '<div style="padding:20px;color:var(--text-muted)">No schema info</div>'; return; }
    el.innerHTML = info[0].values.map(col => {
      const [cid, name, type, notnull, dflt, pk] = col;
      return `<div class="schema-col"><span class="schema-col-name">${escHtml(name)}</span><span class="schema-col-type">${escHtml(type||'any')}</span>${pk?'<span class="schema-col-pk">PK</span>':''}${notnull?'<span class="schema-col-nn">NOT NULL</span>':''}</div>`;
    }).join('');
  }

  function formatCell(cell) {
    if (cell === null) return '<td><span class="cell-null">NULL</span></td>';
    if (typeof cell === 'number') return `<td class="cell-number">${cell}</td>`;
    return `<td class="cell-string" title="${escHtml(String(cell))}">${escHtml(String(cell))}</td>`;
  }

  function escHtml(s) { const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }
  function formatBytes(b) { if (b < 1024) return b + ' B'; if (b < 1048576) return (b/1024).toFixed(1) + ' KB'; return (b/1048576).toFixed(1) + ' MB'; }
  function insertTab(el) { const s = el.selectionStart; el.value = el.value.substring(0,s) + '  ' + el.value.substring(el.selectionEnd); el.selectionStart = el.selectionEnd = s + 2; }
})();
</script>
</body>
</html>
